\documentclass[oneside, twocolumn,9pt,english]{extbook}
\usepackage{fontspec}
\usepackage{array}
\usepackage{blindtext}
\usepackage{subfiles}
\usepackage{longtable}
\usepackage{float}
\usepackage{babel}
\usepackage{cuted}
\usepackage{csquotes}
\usepackage{graphicx}
\usepackage[left = 0.45in, right = 0.45 in, top = 0.45in, bottom = 0.45in]{geometry}
\usepackage{titlesec}
\usepackage{amsmath}
\usepackage{lscape}
\usepackage{enumitem}
\usepackage{setspace}
\usepackage{multicol}
\usepackage[table]{xcolor}  
\usepackage{tikz}
\usepackage{multirow}
\usepackage{float}
\usepackage{tcolorbox}
\usepackage{keyval}
\usepackage{pgfkeys}
\def\apos{'}
\usepackage{environ}
\usepackage{array}
\usepackage[hidelinks]{hyperref}


%%IMPORTANT
\def\coreMode{1}
%%%

%\usepackage{pagecolor}
\setlength{\parskip}{4pt}
\setlength{\parindent}{0pt}
\setlength{\columnsep}{0.7cm}


\definecolor{titlered}{HTML}{58180D} 
\definecolor{rulered}{HTML}{9C2B1B} 
\definecolor{papyrus}{HTML}{FDF1DC} 
\definecolor{papDark}{HTML}{F5EEE9}
\newcommand{\tablecolorlight}{papyrus!17}
\newcommand{\tablecolordark}{papDark!65}
\newcommand{\tablecolorhead}{papDark!250}

\newcommand{\tablehead}{ \rowcolor{\tablecolorhead}}
\newcommand{\tablealternate}{ \rowcolors{2}{\tablecolorlight}{\tablecolordark}}
\newcommand{\archetypealternate}{ \rowcolors{2}{papyrus}{papyrus!40}}

\newfontfamily{\HP}{[ParryHotter.TTF]}
\newcommand\dndFont{texgyrebonum}
\setmainfont[BoldFont = \dndFont-bold.otf,ItalicFont = \dndFont-italic.otf,BoldItalicFont = \dndFont-bolditalic.otf]{\dndFont-regular.otf}
\newcommand{\minus}{-}
\def\comma{,}
\def\dash{-}

\newcommand{\dndline}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth*0.5}, 0.05);
  \end{tikzpicture}%
  \par%
}

\newcommand{\dndlineLong}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth}, 0.05);
  \end{tikzpicture}%
  \par%
}


\newcommand{\dndlineFade}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.5}, 0)--({\textwidth*0.5}, 0.01)--(0, 0.01);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineThird}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.22}, 0)--({\textwidth*0.22}, 0.01)--(0, 0.01);
  \end{tikzpicture}%
  \par%
}

\titleformat{\chapter} {\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline\thechapter: }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{name=\chapter,numberless}{\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{\section}{\vspace{-4ex}\normalfont\huge\color{titlered}\it\centering}{}{0em}{}[{\vspace{-1.45ex}\dndlineFade{rulered}}]
\titleformat{name=\subsection}{\LARGE \bf}{}{0pt}{}[{\vspace{-1.7ex}\dndlineFade{black}}]
\titleformat{name=\subsubsection}{\large \bf}{}{0pt}{}[{\vspace{-1.7ex}\dndlineThird{black}}]

\newsavebox{\tablebox}

\raggedbottom
\NewEnviron{rndtable}[1]{%
  \addtolength{\extrarowheight}{1ex}%
  \rowcolors{2}{\tablecolorlight}{\tablecolordark}%
  \savebox{\tablebox}{%
    \begin{tabular}{#1}%
		 \tablehead
      \BODY%
    \end{tabular}}%
  \begin{tikzpicture}
    \begin{scope}
      \clip[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
      \node at (0,-\dp\tablebox) [anchor=south west,inner sep=0pt]{\usebox{\tablebox}};
    \end{scope}
    \draw[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
  \end{tikzpicture}
}

\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\clearpage\fi
}






\begin{document}
%\pagecolor{papyrus!50}
\begin{titlepage}
    %\newgeometry{left=2.12cm, right = 1.74cm, bottom=1cm}
    \centering
    \vfill
    \if\coreMode1
    {\bfseries
        {\HP \fontsize{40}{35}\selectfont Player Handbook}
    }    
    \fi
    \if\coreMode0
    {\bfseries
        {\HP \fontsize{40}{35}\selectfont Basic Handbook}
    } 
    \fi
    \vfill
    \includegraphics[scale = 0.7]{../Images/glasses} % also works with logo.pdf
    \vfill
    {\HP \fontsize{30}{24} \selectfont  Harry Potter \\\&\\ The Role Playing Game}
    \normalsize
    \vfill
    {\HP \fontsize{22}{0} \selectfont Version 3.0 \hfill Jack Fraser}
\end{titlepage}

\setcounter{tocdepth}{0}  
\begin{spacing}{0.8}
\footnotesize
\tableofcontents
\normalsize
\end{spacing}
\subfile{Chapters/CoreMechanic}

\cleartoleftpage
\part{Characters} \label{C:CharacterCreation}

\subfile{Chapters/CharacterCreation}
%\subfile{Chapters/Archetypes}

\subfile{Chapters/Skills}

\cleartoleftpage
\part{Actions and their Consequences}

\subfile{Chapters/Actions}

\subfile{Chapters/HealthFortitudeStatuses}

\if\coreMode1	
	\subfile{Chapters/Environment}
\fi
\part{Items}

\subfile{Chapters/Items}
\if \coreMode1
	\subfile{Chapters/Artificing}
\fi

\cleartoleftpage
\part{Magic}
\subfile{Chapters/Spells}
\end{document}
