\ProvidesPackage{HPpack}[2020]
%%So many includes!



\usepackage[dvipsnames,table]{xcolor} 
\usepackage{keyval}
\usepackage[no-math]{fontspec}

\usepackage{array}
\usepackage{blindtext}
\usepackage{MnSymbol}
\usepackage{subfiles}
\usepackage{longtable}
\usepackage{amsmath}
\usepackage{cuted}
\usepackage{csquotes}
\usepackage{graphicx}
\usepackage[left = 0.25in, right = 0.25	 in, top = 0.43in, bottom = 0.25in]{geometry}
\usepackage{titlesec}
\usepackage{pdfpages}
\usepackage{lscape}
\usepackage{enumitem}
\usepackage{setspace}
\usepackage{tabularx}
\usepackage{multicol}

\let\origbar\bar
\let\origdot\dot
\usepackage{allrunes}
\let\bar\origbar
\let\dot\origdot 
\usepackage{tikz}
\usepackage{multirow}
\usepackage{float}
\usepackage{tcolorbox}
\usepackage[sans]{dsfont}
\usepackage{eufrak}
\usepackage{rsfso}
\usepackage{tocloft}
\renewcommand{\cftsecnumwidth}{30pt}
\usepackage{soul}
\usepackage{lscape}
\usepackage{fontawesome}
\usepackage[notextcomp]{stix}
\usepackage{makecell}
\usepackage{array}
\usepackage[hidelinks]{hyperref}

\usepackage{phaistos}



%%Page setup
\setlength{\parskip}{4pt}
\setlength{\parindent}{0pt}
\setlength{\columnsep}{0.7cm}


%%Character Substitutions
\def\apos{'}
\newcommand\umlaut[1]{\"{#1}}
\def\inotator{\^In\u{o}tator}
\newcommand\galleon[1]{$\mathfrak{G}$#1}
\newcommand\sickle[1]{{\textara{f}#1}}
\newcommand\knut[1]{$\btimes$#1}
\renewcommand{\minus}{-}
\def\comma{,}
\def\dash{-}


\newcommand\forEvery{for every additional casting-level dedicated to this spell}

\newcommand\additional[2]
{
Gain an additional #1 #2 damage \forEvery{}.
}

%% Custom commands
\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\clearpage\fi
}
\newcommand*\cleartorightpage{%
  \clearpage
  \ifodd\value{page}\else\hbox{}\clearpage\fi
}

%% Colours

\definecolor{titlered}{HTML}{58180D} 
\definecolor{rulered}{HTML}{9C2B1B} 
\definecolor{papyrus}{HTML}{FDF1DC} 
\definecolor{papDark}{HTML}{F5EEE9}
\newcommand{\tablecolorlight}{papyrus!17}
\newcommand{\tablecolordark}{papDark!65}
\newcommand{\tablecolorhead}{papDark!250}
\newcommand{\tableheader}{ \rowcolor{\tablecolorhead}}
\newcommand{\tablealternate}{ \rowcolors{2}{\tablecolorlight}{\tablecolordark}}
\newcommand{\archetypealternate}{ \rowcolors{2}{papyrus}{papyrus!40}}

%%Fontwork

\newfontfamily{\HP}{[ParryHotter.TTF]}
\newcommand\dndFont{texgyrebonum}
\setmainfont[BoldFont = \dndFont-bold.otf,ItalicFont = \dndFont-italic.otf,BoldItalicFont = \dndFont-bolditalic.otf]{\dndFont-regular.otf}

\newcommand\key[1]{\textsc{\textbf{#1}}}
\newcommand\imp[1]{\textsc{#1}}
\newcommand\dv{\key{DV}}
%%DnD-mimicking lines.

\newcommand{\dndline}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth*0.5}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineLong}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineFade}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.5}, 0)--({\textwidth*0.5}, 0)--(0, 0.03);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineThird}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.22}, 0)--({\textwidth*0.22}, 0.01)--(0, 0.01);
  \end{tikzpicture}%
  \par%
}

%%Chapter and section heads
\titleformat{\chapter}{\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline\thechapter: }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{name=\chapter,numberless}{\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{\section}{\normalfont\huge\color{titlered} }{}{0em}{}[{\vspace{-0.55 cm}\dndlineFade{rulered}}]
\titleformat{name=\subsection}{\LARGE \color{titlered}}{}{0pt}{}[{\vspace{-0.43 cm}\dndlineFade{rulered}}]
\titleformat{name=\subsubsection}{\large }{}{0pt}{}[{\vspace{-0.35 cm}\dndlineThird{black}}]

\newcommand\breaklesschapter[1]
{
	%~ \begin{strip}
		%~ %\chapter{#1}
		%~ \stepcounter{chapter}
		%~ \addcontentsline{toc}{chapter}{#1}
		
		%~ {
		%~ \normalfont\bfseries\centering\color{titlered}\HP
		%~ \dndlineLong
		
		%~ \Huge\thechapter: #1
		
		%~ \dndlineLong
		
		%~ }
	%~ \end{strip}
	\chapter{#1}
}




%%Cute Roundtable environment

\newsavebox{\tablebox}

\raggedbottom
\NewEnviron{rndtable}[1]{%
  \addtolength{\extrarowheight}{1ex}%
  \rowcolors{2}{\tablecolorlight}{\tablecolordark}%
  \savebox{\tablebox}{%
    \begin{tabular}{#1}%
		 \tableheader
      \BODY%
    \end{tabular}}%
  \begin{tikzpicture}
    \begin{scope}
      \clip[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
      \node at (0,-\dp\tablebox) [anchor=south west,inner sep=0pt]{\usebox{\tablebox}};
    \end{scope}
    \draw[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
  \end{tikzpicture}
}





%%%% Attribute stuff

\def\attPhys{Fitness}
\def\attFin{Precision}
\def\attSpr{Spirit}
\def\attChr{Charisma}
\def\attInt{Intelligence}
\def\attPer{Perception}
\def\attPow{Power}
\def\attEvl{Evil}
\def\attPhysShort{FIT}
\def\attFinShort{PRS}
\def\attSprShort{SPR}
\def\attChrShort{CHR}
\def\attIntShort{INT}
\def\attPerShort{PCP}
\def\attPowShort{POW}
\def\attEvlShort{EVL}

\newcommand{\emptyCape}{$\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\oneCape}{$\mdblkdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\twoCape}{$\mdblkdiamond\mdblkdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\threeCape}{$\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\fourCape}{$\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdwhtdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\fiveCape}{$\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdwhtdiamond\mdwhtdiamond$}
\newcommand{\sixCape}{$\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdwhtdiamond$}
\newcommand{\sevenCape}{$\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond\mdblkdiamond$}




\newcommand\ratingB[1]
{
	\if#10
		\emptyCape
	\fi
	\if#11
		\oneCape
	\fi
	\if#12
		\twoCape
	\fi
	\if#13
		\threeCape
	\fi
	\if#14
		\fourCape
	\fi
	\if#15
		\fiveCape
	\fi
	\if#16
		\sixCape
	\fi
	\if#17
		\sevenCape
	\fi
	\if#18
		\sevenCape{} + \oneCape
	\fi
	\if#19
		\sevenCape{} + \twoCape
	\fi
	\def\ten{10}
	\ifnum#1=\ten
		\sevenCape{} + \threeCape
	\fi
	
	\def\eleven{11}
	\ifnum#1=\eleven
		\sevenCape{} + \fourCape
	\fi
}



%%weapon stuff
\newcommand\rangetable
{
\begin{center}
	\begin{rndtable}{c c c}
		\bf Range	&	\bf Melee Distance	&	\bf Ranged Distance 
		\\
		Short	&	0m	&	10m
		\\
		Normal	&	1m	&	25m
		\\
		Extended	&	2m	&	50m
		\\
		Long	&	3m	&	100m
		\\
		Extreme	&	10m	&	1km
	\end{rndtable}
\end{center}
}



%%AC stuff
\def\baseDodge{8}
\def\baseBlock{8}

%stupid broken matlab thing
\def\negTwo{-2}

%% Spell stuff
\newcommand\boldItem[2]
{
	\item {\bf #1}: #2
}

\newcommand\keyItem[2]
{
	\item \key{#1}: #2
}
\newcommand\emphItem[2]
{
	\item \textit{\textbf{#1}}: #2
}
\newcommand\dualEntry[2]
{
#1	& #2	\\
}
% Custom list environment for inside spells
\newlist{spellitemize}{itemize}{2}
\setlist[spellitemize,1]{label=\textbullet,leftmargin=2 ex}
\setlist[spellitemize,2]{label=-,leftmargin=0em}

\newcommand\PPDifference[2]
{
 {\the\numexpr(#1 -#2)\relax} 
}


\def\DVBeg{5}
\def\DVNov{8}
\def\DVAdp{12}
\def\DVExp{15}
\def\DVMas{20}


\def\wFP{0.6}








\def\levelZero{\imp{Nihil}}
\def\levelOne{\imp{Primus}}
\def\levelTwo{\imp{Dua}}
\def\levelThree{\imp{Tria}}
\def\levelFour{\imp{Qartum}}
\def\levelFive{\imp{Qinta}}
\def\levelSix{\imp{Sextus}}
\def\levelSeven{\imp{Sumnus}}

%%%%RATINGS TABLE
\newcommand\dualRow[2]{#1	&	#2	\\}
\newcommand\triRow[3]{#1	&	#2	& #3\\}
\newcommand\ratingTable[8]
{
\dotTable{#1}{#2}{#3}{#4}{#5}{#6}{#7}{#8}{Summary}
}
\newcommand\spellTable
{

\begin{center}
\footnotesize
\begin{rndtable}{c p{7.8 cm}}
\bf Ratings&	\bf Example Spells \\

	\if\haszero1
		\dualRow{\emptyCape}{\zero}
	\fi
	\if\hasone1
	\dualRow{\oneCape}{\one}
	\fi
	\if\hastwo1
		\dualRow{\twoCape}{\two}
	\fi
	\if\hasthree1
		\dualRow{\threeCape}{\three}
	\fi
	\if\hasfour1
		\dualRow{\fourCape}{\four}
	\fi
	\if\hasfive1
		\dualRow{\fiveCape}{\five}
	\fi
	\if\hassix1
		\dualRow{\sixCape}{\six}
	\fi
	\if\hasseven1
		\dualRow{\sevenCape}{\seven}
	\fi
\end{rndtable}
\end{center} 
}
\newcommand\dotTable[9]
{

\begin{center}
\footnotesize
\begin{rndtable}{c p{7.8 cm}}
\bf Rating&\bf #9 \\
\dualRow{\emptyCape}{#1}
\dualRow{\oneCape}{#2}
\dualRow{\twoCape}{#3}
\dualRow{\threeCape}{#4}
\dualRow{\fourCape}{#5}
\dualRow{\fiveCape}{#6}
\dualRow{\sixCape}{#7}
\dualRow{\sevenCape}{#8}
\end{rndtable}
\end{center} 
}
\newcommand\extendedRatingTable[8]
{

\begin{center}
\footnotesize
\begin{rndtable}{c c p{6.3 cm}}
\bf Rating&\bf Name & \bf Summary \\
\triRow{\emptyCape}#1
\triRow{\oneCape}#2
\triRow{\twoCape}#3
\triRow{\threeCape}#4
\triRow{\fourCape}#5
\triRow{\fiveCape}#6
\triRow{\sixCape}#7
\triRow{\sevenCape}#8
\end{rndtable}
\end{center} 
}


\def\s{0.22}
\def\w{1.7}

\newcommand\spellEntry[2]
{
	#1	&	#2
}
\def\emptySpell{ \spellEntry{~}{~}}
\newcommand\spellHeader[1]
{
	\multicolumn{2}{c}{\cellcolor{\tablecolorhead} \bf #1}
}
\def\headers
{
	\spellHeader{Trivial}	&	\spellHeader{Beginner}	&	\spellHeader{Novice}	&	\spellHeader{Adept}	&	\spellHeader{Expert}	&	\spellHeader{Master}	&	\spellHeader{Ascendant} \\
}
\newcommand\spellRow[7]
{
	#1	&	#2	&	#3	&	#4	&	#5	&	#6	&	#7 \\
}

\newcommand\discTable[2]
{
	\begin{rndtable}{@{} >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c >{\centering\arraybackslash}m{\w cm} c @{}}
	\multicolumn{14}{c}{\bf \normalsize #1} \\
	\headers{}
	#2
	\end{rndtable}


}


\newcommand\schoolTables[2]
{
	{
	\scriptsize
	\subsection{#1}
	#2
	}
}


\def\instSymb{\faMagic}
\def\concSymb{\faEye}
\def\wardSymb{\faShield}
\def\musicSymb{$\twonotes$}
\def\ritSymb{$\largepentagram$}
\def\beastSymb{\faPaw}
\newcommand\mult[2]
{
\the\numexpr((1+#2)*#1)/2\relax	
}

\def\skillGap{-2 ex}

\newcommand\FPEntry[2]
{
\!\mult{#1}{#2}
}

\def\wS{3}
\def\xS{2}
\newcommand\col[2]{\multicolumn{1}{c}{\parbox[t]{#2 cm}{\raggedright \imp{#1}}}}

\newcommand\school[5]
{
\cline{1-3}
	\cellcolor{\tablecolorhead}	& 	\col{#2}{\xS}	& 	\col{#3}{\wS} 	\\ \cline{2-3}
   \cellcolor{\tablecolorhead}\multirow{-2}{*}{\bf #1}& \col{#4}{\xS} & \col{#5}{\wS} 
}






%%% feats

\newcommand\feat[4]
{
	{\footnotesize
	\key{#1{}:} 
	\if#31
		(Prerequisite: #4)
		
	\fi
	{\it #2} 
	}
	

}




%%Enchanting stuff
\def\displos{H}
\def\velox{C}
\def\lentus{X}
\def\aeternum{\X}

\def\primum{F}
\def\motu{\T}
\def\animus{\belgthor}
\def\aevum{\thth}
\def\canto{Y}
\def\vinco{y}
\def\basiorum{m}
\def\morbus{\rdot}
\def\sarco{q}
\def\clypus{p}
\def\muto{\tring}
\def\genero{\x}
\def\lues{\Y}
\def\ritus{\y}
\def\vox{s}
\def\oculum{w}
\def\iuxta{\arlaug}
\def\salto{o}
\def\fabulum{\Pdots}
\def\mentis{x}
\def\sessio{E}
\def\seculum{\dh}
\def\animax{\tvimadur}

\newcommand\rune[1]
{
\textarm{\textwil{#1}}
}


\def\cc{\cellcolor{\tablecolorhead}\bf}



%%%%%%%%%%%%%%% BEAST STUFF


\newcommand\imbuement[2]
{
	{\bf #1}
	
	\begin{spellitemize}
		#2
	\end{spellitemize}
}

%%%%% Progression Table 

\newcommand\expRow[2]{{\bf #1}	&	\parbox[t]{4cm}{#2}	\\}

\def\progressionCosts
{
			\expRow{Increase Aspect Rating}{$=~2~\times$ new attribute score}
			\expRow{Increase Affinity Rating}{$=~3~\times$ new affinity score}
			\expRow{Increase Major Ability Rating}{=~ New \imp{Ability} score}
			\expRow{Swap Major and Minor Ability}{ =~ 1 \imp{Exp}}
			\expRow{Gain New Feat}{ =~ 7 \imp{Exp}}
			\expRow{Increase Health or Fortitude}{ =$~$ 10 + 4 for each previous purchase}
}

