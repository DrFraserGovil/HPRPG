\ProvidesPackage{HPpack}[2020]

%%So many includes!
\usepackage{keyval}
\usepackage[no-math]{fontspec}
\usepackage{array}
\usepackage{blindtext}
\usepackage{MnSymbol}
\usepackage{subfiles}
\usepackage{longtable}
\usepackage{amsmath}
\usepackage{cuted}
\usepackage{csquotes}
\usepackage{graphicx}
\usepackage[left = 0.4in, right = 0.4 in, top = 0.45in, bottom = 0.42in]{geometry}
\usepackage{titlesec}
\usepackage{lscape}
\usepackage{enumitem}
\usepackage{setspace}
\usepackage{multicol}
\usepackage[table]{xcolor}  
\usepackage{tikz}
\usepackage{multirow}
\usepackage{float}
\usepackage{tcolorbox}
\usepackage[sans]{dsfont}
\usepackage{eufrak}
\usepackage{rsfso}
\usepackage{tocloft}
\renewcommand{\cftsecnumwidth}{30pt}
\usepackage{soul}
\usepackage{lscape}
\usepackage{fontawesome}
\usepackage[notextcomp]{stix}
\usepackage{makecell}
\usepackage{array}
\usepackage[hidelinks]{hyperref}

%%Page setup
\setlength{\parskip}{4pt}
\setlength{\parindent}{0pt}
\setlength{\columnsep}{0.7cm}


%%Character Substitutions
\def\apos{'}
\def\galleon{$\mathfrak{G}$}
\def\sickle{$\wreath$}
\def\knut{$\btimes$}
\renewcommand{\minus}{-}
\def\comma{,}
\def\dash{-}

%% Custom commands
\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\clearpage\fi
}


%% Colours

\definecolor{titlered}{HTML}{58180D} 
\definecolor{rulered}{HTML}{9C2B1B} 
\definecolor{papyrus}{HTML}{FDF1DC} 
\definecolor{papDark}{HTML}{F5EEE9}
\newcommand{\tablecolorlight}{papyrus!17}
\newcommand{\tablecolordark}{papDark!65}
\newcommand{\tablecolorhead}{papDark!250}
\newcommand{\tablehead}{ \rowcolor{\tablecolorhead}}
\newcommand{\tablealternate}{ \rowcolors{2}{\tablecolorlight}{\tablecolordark}}
\newcommand{\archetypealternate}{ \rowcolors{2}{papyrus}{papyrus!40}}

%%Fontwork

\newfontfamily{\HP}{[ParryHotter.TTF]}
\newcommand\dndFont{texgyrebonum}
\setmainfont[BoldFont = \dndFont-bold.otf,ItalicFont = \dndFont-italic.otf,BoldItalicFont = \dndFont-bolditalic.otf]{\dndFont-regular.otf}

%%DnD-mimicking lines.

\newcommand{\dndline}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth*0.5}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineLong}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineFade}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.5}, 0)--({\textwidth*0.5}, 0)--(0, 0.03);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineThird}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.22}, 0)--({\textwidth*0.22}, 0.01)--(0, 0.01);
  \end{tikzpicture}%
  \par%
}

%%Chapter and section heads
\titleformat{\chapter} {\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline\thechapter: }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{name=\chapter,numberless}{\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{\section}{\normalfont\huge\color{titlered} }{}{0em}{}[{\vspace{-0.55 cm}\dndlineFade{rulered}}]
\titleformat{name=\subsection}{\LARGE \bf}{}{0pt}{}[{\vspace{-0.43 cm}\dndlineFade{black}}]
\titleformat{name=\subsubsection}{\large }{}{0pt}{}[{\vspace{-0.35 cm}\dndlineThird{black}}]

%%Cute Roundtable environment

\newsavebox{\tablebox}

\raggedbottom
\NewEnviron{rndtable}[1]{%
  \addtolength{\extrarowheight}{1ex}%
  \rowcolors{2}{\tablecolorlight}{\tablecolordark}%
  \savebox{\tablebox}{%
    \begin{tabular}{#1}%
		 \tablehead
      \BODY%
    \end{tabular}}%
  \begin{tikzpicture}
    \begin{scope}
      \clip[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
      \node at (0,-\dp\tablebox) [anchor=south west,inner sep=0pt]{\usebox{\tablebox}};
    \end{scope}
    \draw[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
  \end{tikzpicture}
}




%% Spell stuff

% Custom list environment for inside spells
\newlist{spellitemize}{itemize}{2}
\setlist[spellitemize,1]{label=\textbullet,leftmargin=2 ex}
\setlist[spellitemize,2]{label=-,leftmargin=0em}

\newcommand\PPDifference[2]
{
 {\the\numexpr(#1 -#2)\relax} 
}


\def\DVBegI{4}
\def\DVNovI{5}
\def\DVAdpI{6}
\def\DVExpI{7}
\def\DVMasI{11}
\def\DVBegF{3}
\def\DVNovF{4}
\def\DVAdpF{5}
\def\DVExpF{6}
\def\DVMasF{9}
\def\DVBegW{4}
\def\DVNovW{6}
\def\DVAdpW{8}
\def\DVExpW{10}
\def\DVMasW{12}
\def\DVBegR{3}
\def\DVNovR{5}
\def\DVAdpR{8}
\def\DVExpR{10}
\def\DVMasR{12}

\def\wFP{0.6}

\def\ElCheck{INT}
\def\KinCheck{FIN}
\def\TelCheck{PER}
\def\TemCheck{INT}
\def\BewCheck{CHR}
\def\PsiCheck{SPR}
\def\HexCheck{SPR}
\def\CurCheck{POW}
\def\HeaCheck{EMP}
\def\WarCheck{INT}
\def\AltCheck{FIN}
\def\ConCheck{POW}
\def\NecCheck{EVL}
\def\OccCheck{POW}


\newcommand\mult[2]
{
\the\numexpr((1+#2)*#1)/2\relax	
}

\def\skillGap{-2 ex}

\newcommand\FPEntry[2]
{
\!\mult{#1}{#2}
}

\def\wS{4.8}
\def\xS{1.4}
\newcommand\col[2]{\multicolumn{1}{c}{\parbox[t]{#2 cm}{\raggedright #1}}}

\newcommand\school[5]
{
\cline{1-3}
	\cellcolor{\tablecolorhead}	& 	\col{#2}{\xS}	& 	\col{#3}{\wS} 	\\ \cline{2-3}
   \cellcolor{\tablecolorhead}\multirow{-2}{*}{\bf #1}& \col{#4}{\xS} & \col{#5}{\wS} 
}


%%Potion stuff

\makeatletter
\define@key{potion}{name}{\def\name{#1}}
\define@key{potion}{description}{\def\visible{#1}}
\define@key{potion}{cost}{\def\cost{#1}}
\define@key{potion}{effect}{\def\effect{#1}}
\define@key{potion}{difficulty}{\def\difficulty{#1}}
\define@key{potion}{time}{\def\time{#1}}
\define@key{potion}{othereffect}{\def\side{#1}}
\define@key{potion}{doses}{\def\dose{#1}}
\define@key{potion}{essential}{\def\essential{#1}}
\define@key{potion}{optional}{\def\optional{#1}}
\makeatother
\def\q{4.2}
\def\g{0.8}
\def\h{1.8}
\def\l{1.3}
\newcommand{\potion}[1]
{
	\setkeys{potion}{name=None}
	\setkeys{potion}{#1}
	\vbox{
	\renewcommand{\arraystretch}{1.2}
	{\normalsize \color{rulered}\name }

	\footnotesize
	{\it \visible}
	
	
	
	\vspace{1ex}
	\begin{tabular}{>{\centering\arraybackslash}m{\g cm} >{\centering\arraybackslash}m{\h cm} >{\centering\arraybackslash}m{\g cm} >{\centering\arraybackslash}m{\l cm}}
		\bf Cost	&	\bf Mixing Time	&\bf Dose&	\bf Difficulty 
		\\
		\cost{}	&	\time{}	& \dose{}&	\difficulty{} 
	\end{tabular}

\vspace{1 ex}
{\bf Ingredients}:~~		\parbox[t]{\q cm}{ \raggedright \essential}


	{\raggedright \effect}
	}
	
	
	\vspace{3 ex}
}




