\ProvidesPackage{HPpack}[2020]

%%So many includes!
\usepackage[dvipsnames,table]{xcolor} 
\usepackage{keyval}
\usepackage[no-math]{fontspec}
\usepackage{array}
\usepackage{blindtext}
\usepackage{MnSymbol}
\usepackage{subfiles}
\usepackage{longtable}
\usepackage{amsmath}
\usepackage{cuted}
\usepackage{csquotes}
\usepackage{graphicx}
\usepackage[left = 0.35in, right = 0.35	 in, top = 0.42in, bottom = 0.3in]{geometry}
\usepackage{titlesec}
\usepackage{lscape}
\usepackage{enumitem}
\usepackage{setspace}
\usepackage{multicol}
\let\origbar\bar
\let\origdot\dot
\usepackage{allrunes}
\let\bar\origbar
\let\dot\origdot 
\usepackage{tikz}
\usepackage{multirow}
\usepackage{float}
\usepackage{tcolorbox}
\usepackage[sans]{dsfont}
\usepackage{eufrak}
\usepackage{rsfso}
\usepackage{tocloft}
\renewcommand{\cftsecnumwidth}{30pt}
\usepackage{soul}
\usepackage{lscape}
\usepackage{fontawesome}
\usepackage[notextcomp]{stix}
\usepackage{makecell}
\usepackage{array}
\usepackage[hidelinks]{hyperref}

%%Page setup
\setlength{\parskip}{4pt}
\setlength{\parindent}{0pt}
\setlength{\columnsep}{0.7cm}


%%Character Substitutions
\def\apos{'}


\newcommand\galleon[1]{$\mathfrak{G}$#1}
\newcommand\sickle[1]{{\textara{f}#1}}
\newcommand\knut[1]{$\btimes$#1}
\renewcommand{\minus}{-}
\def\comma{,}
\def\dash{-}


\newcommand\forEvery{for every additional casting-level dedicated to this spell}

\newcommand\additional[2]
{
Gain an additional #1 #2 damage \forEvery{}.
}

%% Custom commands
\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\clearpage\fi
}
\newcommand*\cleartorightpage{%
  \clearpage
  \ifodd\value{page}\else\hbox{}\clearpage\fi
}

%% Colours

\definecolor{titlered}{HTML}{58180D} 
\definecolor{rulered}{HTML}{9C2B1B} 
\definecolor{papyrus}{HTML}{FDF1DC} 
\definecolor{papDark}{HTML}{F5EEE9}
\newcommand{\tablecolorlight}{papyrus!17}
\newcommand{\tablecolordark}{papDark!65}
\newcommand{\tablecolorhead}{papDark!250}
\newcommand{\tableheader}{ \rowcolor{\tablecolorhead}}
\newcommand{\tablealternate}{ \rowcolors{2}{\tablecolorlight}{\tablecolordark}}
\newcommand{\archetypealternate}{ \rowcolors{2}{papyrus}{papyrus!40}}

%%Fontwork

\newfontfamily{\HP}{[ParryHotter.TTF]}
\newcommand\dndFont{texgyrebonum}
\setmainfont[BoldFont = \dndFont-bold.otf,ItalicFont = \dndFont-italic.otf,BoldItalicFont = \dndFont-bolditalic.otf]{\dndFont-regular.otf}

%%DnD-mimicking lines.

\newcommand{\dndline}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth*0.5}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineLong}{%
  \noindent
  \begin{tikzpicture}[]
    \draw [rulered, fill=rulered] (0, 0) --(0,0.1) -- ({\textwidth}, 0.05);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineFade}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.5}, 0)--({\textwidth*0.5}, 0)--(0, 0.03);
  \end{tikzpicture}%
  \par%
}
\newcommand{\dndlineThird}[1]{%
  \noindent
  \begin{tikzpicture}[]
    \fill [left color = #1, shading=axis, shading angle = 90] (0, 0)--({\textwidth*0.22}, 0)--({\textwidth*0.22}, 0.01)--(0, 0.01);
  \end{tikzpicture}%
  \par%
}

%%Chapter and section heads
\titleformat{\chapter} {\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline\thechapter: }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{name=\chapter,numberless}{\vspace{-14ex}\normalfont\bfseries\centering\color{titlered}\HP\Huge}{}{0pt}{\dndline }[\vspace{-1.6ex}\dndline\vspace{-3ex}]
\titleformat{\section}{\normalfont\huge\color{titlered} }{}{0em}{}[{\vspace{-0.55 cm}\dndlineFade{rulered}}]
\titleformat{name=\subsection}{\LARGE \color{titlered}}{}{0pt}{}[{\vspace{-0.43 cm}\dndlineFade{rulered}}]
\titleformat{name=\subsubsection}{\large }{}{0pt}{}[{\vspace{-0.35 cm}\dndlineThird{black}}]

%%Cute Roundtable environment

\newsavebox{\tablebox}

\raggedbottom
\NewEnviron{rndtable}[1]{%
  \addtolength{\extrarowheight}{1ex}%
  \rowcolors{2}{\tablecolorlight}{\tablecolordark}%
  \savebox{\tablebox}{%
    \begin{tabular}{#1}%
		 \tableheader
      \BODY%
    \end{tabular}}%
  \begin{tikzpicture}
    \begin{scope}
      \clip[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
      \node at (0,-\dp\tablebox) [anchor=south west,inner sep=0pt]{\usebox{\tablebox}};
    \end{scope}
    \draw[rounded corners=1ex] (0,-\dp\tablebox) -- (\wd\tablebox,-\dp\tablebox) -- (\wd\tablebox,\ht\tablebox) -- (0,\ht\tablebox) -- cycle;
  \end{tikzpicture}
}





%%%% Attribute stuff

\def\attPhys{Fitness}
\def\attFin{Precision}
\def\attSpr{Spirit}
\def\attChr{Charisma}
\def\attInt{Intelligence}
\def\attPer{Perception}
\def\attPow{Power}
\def\attEvl{Evil}
\def\attPhysShort{FIT}
\def\attFinShort{PRS}
\def\attSprShort{SPR}
\def\attChrShort{CHR}
\def\attIntShort{INT}
\def\attPerShort{PCP}
\def\attPowShort{POW}
\def\attEvlShort{EVL}



%%AC stuff
\def\baseDodge{8}
\def\baseBlock{8}

%stupid broken matlab thing
\def\negTwo{-2}

%% Spell stuff
\newcommand\boldItem[2]
{
	\item {\bf #1}: #2
}
\newcommand\emphItem[2]
{
	\item \textit{\textbf{#1}}: #2
}
% Custom list environment for inside spells
\newlist{spellitemize}{itemize}{2}
\setlist[spellitemize,1]{label=\textbullet,leftmargin=2 ex}
\setlist[spellitemize,2]{label=-,leftmargin=0em}

\newcommand\PPDifference[2]
{
 {\the\numexpr(#1 -#2)\relax} 
}


\def\DVBeg{5}
\def\DVNov{8}
\def\DVAdp{12}
\def\DVExp{15}
\def\DVMas{20}


\def\wFP{0.6}



\def\ElCheck{\attPow{}}
\def\KinCheck{\attFin{}}
\def\TelCheck{\attPer{}}
\def\TemCheck{\attInt{}}
\def\BewCheck{\attChr{}}
\def\PsiCheck{\attSpr{}}
\def\HexCheck{\attSpr{}}
\def\CurCheck{\attPow{}}
\def\HeaCheck{\attPer{}}
\def\WarCheck{\attInt{}}
\def\AltCheck{\attFin{}}
\def\ConCheck{\attPow{}}
\def\NecCheck{\attEvl{}}
\def\OccCheck{\attChr{}}





\def\instSymb{\faMagic}
\def\concSymb{\faEye}
\def\wardSymb{\faShield}
\def\musicSymb{$\twonotes$}
\def\ritSymb{$\largepentagram$}
\def\beastSymb{\faPaw}
\newcommand\mult[2]
{
\the\numexpr((1+#2)*#1)/2\relax	
}

\def\skillGap{-2 ex}

\newcommand\FPEntry[2]
{
\!\mult{#1}{#2}
}

\def\wS{4.8}
\def\xS{1.4}
\newcommand\col[2]{\multicolumn{1}{c}{\parbox[t]{#2 cm}{\raggedright #1}}}

\newcommand\school[5]
{
\cline{1-3}
	\cellcolor{\tablecolorhead}	& 	\col{#2}{\xS}	& 	\col{#3}{\wS} 	\\ \cline{2-3}
   \cellcolor{\tablecolorhead}\multirow{-2}{*}{\bf #1}& \col{#4}{\xS} & \col{#5}{\wS} 
}



\makeatletter
\define@key{spell}{name}{\def\name{#1}}
\define@key{spell}{incant}{\def\incant{#1}}
\define@key{spell}{school}{\def\school{#1}}
\define@key{spell}{discipline}{\def\discipline{#1}}
\define@key{spell}{type}{\def\type{#1}}
\define@key{spell}{level}{\def\level{#1}}
\define@key{spell}{fp}{\def\fp{#1}}
\define@key{spell}{attribute}{\def\att{#1}}
\define@key{spell}{proficiency}{\def\prof{#1}}
\define@key{spell}{dv}{\def\dv{#1}}
\define@key{spell}{effect}{\def\effect{#1}}
\define@key{spell}{duration}{\def\duration{#1}}
\define@key{spell}{noIncant}{\def\incantMode{#1}}
\define@key{spell}{noProf}{\def\profMode{#1}}
\define@key{spell}{noDur}{\def\durMode{#1}}
\define@key{spell}{higher}{\def\higher{#1}}
\define@key{spell}{noHigh}{\def\highMode{#1}}

\define@key{spell}{resist}{\def\resist{#1}}
\define@key{spell}{resistDV}{\def\resistDV{#1}}

\define@key{spell}{noResist}{\def\resistMode{#1}}
\define@key{spell}{noBlock}{\def\blockMode{#1}}
\define@key{spell}{negation}{\def\negation{#1}}
\define@key{spell}{range}{\def\range{#1}}
\makeatother
\newcommand{\spell}[1]
{
	\setkeys{spell}{name=None,incant = \minus{}, school = None, discipline=None,type = None, level = 0, fp = 0, attribute = None, proficiency = None, dv = 0, effect = None,noIncant = 0,noProf=0,noDur=0,duration=None,higher=None,noHigh=0, resist = None, resistDV = none, noResist = 0,noBlock=0,negation=None,range = None}
	\setkeys{spell}{#1}
	\vbox{
	{\normalsize \color{rulered}\name }
	\footnotesize
	
		
	{\it \level{}\minus{}level \school{} (\discipline)} 
	\vspace{1ex}
	
	\begin{tabular}{@{} l  l @{}}
		
	
	
		
		{\bf Spell Type:} & \type \\ 
	
	
	\if\incantMode0 
			{\bf Incantation:} & {\it \incant} \\
		\fi
	
	\if\durMode0
		{\bf Duration}  & \duration \\
	\fi
	
	{\bf Range}	&	\range \\
	
	\if\resistMode0
		{\bf Resist: } & \resist \\
	\fi
	\if\blockMode0
		{\bf Negation: }	&	\negation
	\fi
	%~{\bf DV:}~~~~~~~~~\quad~~~~\dv
	
	\end{tabular}
	}
	{\footnotesize
	\vspace{1ex}
	
	\effect
	
	\vspace{1 ex}
	

	\if\highMode0

		\higher
	\fi
	}
	\vspace{3ex}
	
	\small
}



%%Potion stuff

\makeatletter
\define@key{potion}{name}{\def\name{#1}}
\define@key{potion}{description}{\def\visible{#1}}
\define@key{potion}{cost}{\def\cost{#1}}
\define@key{potion}{effect}{\def\effect{#1}}
\define@key{potion}{difficulty}{\def\difficulty{#1}}
\define@key{potion}{time}{\def\time{#1}}
\define@key{potion}{othereffect}{\def\side{#1}}
\define@key{potion}{doses}{\def\dose{#1}}
\define@key{potion}{essential}{\def\essential{#1}}
\define@key{potion}{optional}{\def\optional{#1}}
\makeatother
\def\q{4.2}
\def\g{0.8}
\def\h{1.8}
\def\l{1.3}
\newcommand{\potion}[1]
{
	\setkeys{potion}{name=None}
	\setkeys{potion}{#1}
	\vbox{
	\renewcommand{\arraystretch}{1.2}
	{\normalsize \color{rulered}\name }

	\footnotesize
	{\it \visible}
	
	
	
	\vspace{1ex}
	\begin{tabular}{>{\centering\arraybackslash}m{\g cm} >{\centering\arraybackslash}m{\h cm} >{\centering\arraybackslash}m{\g cm} >{\centering\arraybackslash}m{\l cm}}
		\cellcolor{white}\textbf{Cost}	&	\bf Mixing Time	&\bf Dose&	\bf Difficulty 
		\\
		\cost{}	&	\time{}	& \dose{}&	\difficulty{} 
	\end{tabular}

\vspace{1 ex}
{\bf Ingredients}:~~		\parbox[t]{\q cm}{ \raggedright \essential}


	{\raggedright \effect}
	}
	
	
	\vspace{3 ex}
}


%%Enchanting stuff
\def\displos{H}
\def\velox{C}
\def\lentus{X}
\def\aeternum{\X}

\def\cingo{p}
\def\clypus{\D}
\def\discite{\belgthor}
\def\genero{m}
\def\imperum{\Pdots}
\def\muto{\tring}
\def\perdero{y}
\def\porto{\T}
\def\sarco{o}

\def\animus{\y}
\def\aqua{\dh}
\def\arbor{Y}
\def\belua{\tvimadur}
\def\caelus{\x}
\def\fabula{\thth}
\def\hominus{x}
\def\ignis{F}
\def\locus{\e}
\def\lux{w}
\def\morbus{\rdot}
\def\pondus{\Y}
\def\sensus{s}
\def\tempus{E}
\def\terra{\arlaug}

\newcommand\rune[1]
{
\textarm{\textwil{#1}}
}




%%%%%%%%%%%%%%% BEAST STUFF

\newcommand\beastSpell[2]
{
	\bf #1	&	\parbox[t]{7.3  cm}{{\it #2}} \\
}
\newcommand\beastSpellList[1]
{
	
	\begin{tabular}{l l}
	#1
	\end{tabular}
}
\definecolor{statblockbg}{HTML}{FDF1DC} 

\makeatletter
\define@key{beast}{name}{\def\name{#1}}
\define@key{beast}{species}{\def\species{#1}}
\define@key{beast}{mind}{\def\mind{#1}}
\define@key{beast}{category}{\def\category{#1}}
\define@key{beast}{summary}{\def\summary{#1}}
\define@key{beast}{hp}{\def\hp{#1}}
\define@key{beast}{fp}{\def\fp{#1}}
\define@key{beast}{hasFP}{\def\fpMode{#1}}
\define@key{beast}{speed}{\def\speed{#1}}
\define@key{beast}{fit}{\def\fit{#1}}
\define@key{beast}{prs}{\def\prs{#1}}
\define@key{beast}{spr}{\def\spr{#1}}
\define@key{beast}{chr}{\def\chr{#1}}
\define@key{beast}{int}{\def\int{#1}}
\define@key{beast}{pcp}{\def\pcp{#1}}
\define@key{beast}{pow}{\def\pow{#1}}
\define@key{beast}{evl}{\def\evl{#1}}
\define@key{beast}{block}{\def\block{#1}}
\define@key{beast}{dodge}{\def\dodge{#1}}
\define@key{beast}{hasImmune}{\def\immuneMode{#1}}
\define@key{beast}{immune}{\def\immune{#1}}
\define@key{beast}{hasResistance}{\def\resistanceMode{#1}}
\define@key{beast}{resistance}{\def\resistance{#1}}
\define@key{beast}{hasSusceptible}{\def\susceptibleMode{#1}}
\define@key{beast}{susceptible}{\def\susceptible{#1}}
\define@key{beast}{hasAbilities}{\def\abilitiesMode{#1}}
\define@key{beast}{abilities}{\def\abilities{#1}}
\define@key{beast}{hasSkills}{\def\skillsMode{#1}}
\define@key{beast}{skills}{\def\skills{#1}}
\define@key{beast}{hasActions}{\def\actionMode{#1}}
\define@key{beast}{actions}{\def\actions{#1}}
\define@key{beast}{habitat}{\def\habitat{#1}}
\define@key{beast}{sizeName}{\def\sizeName{#1}}
\define@key{beast}{size}{\def\size{#1}}
\define@key{beast}{abilityBlock}{\def\aBlock{#1}}
\define@key{beast}{description}{\def\description{#1}}
\define@key{beast}{image}{\def\image{#1}}
\define@key{beast}{hasImage}{\def\imageMode{#1}}
\define@key{beast}{imPosition}{\def\imagePos{#1}}
\define@key{beast}{hasLanguages}{\def\languageMode{#1}}
\define@key{beast}{language}{\def\languages{#1}}
\define@key{beast}{needsLine}{\def\needsLine{#1}}
\define@key{beast}{comprehend}{\def\comprehend{#1}}
\define@key{beast}{hasComprehend}{\def\comprehendMode{#1}}
\define@key{beast}{imageHeight}{\def\imageHeight{#1}}
\define@key{beast}{habitat}{\def\habitat{#1}}
\define@key{beast}{needsPage}{\def\needsPage{#1}}
\define@key{beast}{rating}{\def\rating{#1}}
\define@key{beast}{hasHabitat}{\def\hasHabitat{#1}}
\define@key{beast}{hasLair}{\def\hasLair{#1}}
\define@key{beast}{lairActions}{\def\lairActions{#1}}
\define@key{beast}{hasSenses}{\def\hasSenses{#1}}
\define@key{beast}{senses}{\def\senses{#1}}
\define@key{beast}{hasConditionImmune}{\def\hasConditionImmune{#1}}
\define@key{beast}{conditionImmune}{\def\conditionImmune{#1}}
%%keyEnd    
\makeatother

\def\defaultSetter
{
	\setkeys{beast}{name = none, species = None, mind = none, category = none, summary = none, hp = 0, fp = 0, speed = 0m, fit =0, prs = 0, spr = 0, chr = 0, int = 0, pcp = 0, pow = 0, evl = 0, block = 0, dodge = 0, hasImmune = 0, immune = none, hasResistance = 0, resistance = none, hasSusceptible = 0, susceptible = none, hasAbilities =0, abilities = None, hasActions = 0, actions = None, habitat = Nowhere, sizeName = Height, size = 0, description = No description,hasFP = 0,abilityBlock=0,skills=none,hasSkills=0,image = None,hasImage = 0,imPosition=0,needsLine = 1, hasLanguages = 0, language = none,hasComprehend = 0, comprehend = none,imageHeight = 0.5,habitat = nowhere,needsPage = 0,hasHabitat = 0,hasLair = 0,rating = Unset, hasSenses = 0, hasConditionImmune = 0}
}

\newcommand\timeLimit[2]
{
{\it (#1/#2)}
}
\newcommand\recharge[2]
{
{\it(#1/recharge: #2)}
}

\newcommand\titleBlock
{
	
	\definecolor{rulered}{HTML}{9C2B1B} 
		{ \Large \color{titlered}{\MakeUppercase{\name{}} }}
		
		{\it \summary{} (\mind{}~\category{}) }

		MoM Rating: \rating{}
		
}

\newcommand\statTable[1]
{
	\lineCross{#1}
	{
	\footnotesize
	\begin{center}
		\begin{tabular}{@{} c c c c c c c c @{}}
			\bf \color{titlered}{\attPhysShort{}}	&	\bf \color{titlered}{\attFinShort{}}	&	\bf \color{titlered}{\attSprShort{}}	&	\bf \color{titlered}{\attChrShort{}}	&	\bf \color{titlered}{\attIntShort{}}	&	\bf \color{titlered}{\attPerShort{}}	&	\bf \color{titlered}{\attPowShort{}}	&	\bf \color{titlered}{\attEvlShort{}}
			\\
			\color{titlered}{\fit}		&	\color{titlered}{\prs}	&	\color{titlered}{\spr}	&	\color{titlered}{\chr}	&	\color{titlered}{\int}	&	\color{titlered}{\pcp}	&	\color{titlered}{\pow}&	\color{titlered}{\evl}
		\end{tabular}
	\end{center}
	}
	\lineCross{#1}
}

\newcommand\dEmph[1]
{
	\textbf{\textit{#1}}
}
\newcommand\ifAbility[3]
{
	\if#11
		\dEmph{#2:}{#3}
	\fi
}

\newcommand\abilitiesBlock[1]
{
	\setlength\parskip{3 pt}
		
	\ifAbility{\skillsMode}{Expertise}{\skills}
	
	\ifAbility{\hasSenses}{Senses}{\senses}
	
	\ifAbility{\hasConditionImmune}{Condition Immunity}{\conditionImmune}
	
	\ifAbility{\immuneMode}{Immunity}{\immune}
	
	\ifAbility{\resistanceMode}{Resistance}{\resistance}
	
	\ifAbility{\susceptibleMode}{Susceptible}{\susceptible}
	
	\ifAbility{\languageMode}{Speaks}{\languages}
	
	\ifAbility{\comprehendMode}{Understands}{\comprehend}
	
	\if\needsLine1
		\lineCross{#1}
	\fi
	
	\abilities

}

\newcommand\ability[2]
{
\textbf{\textit{#1}}: #2
}
\newcommand\melee[3]
{
\textbf{\textit{#1}}: ({\it melee attack, #2 to hit}) #3
}
\newcommand\ranged[4]
{
\textbf{\textit{#1}}: ({\it ranged attack, #2 to hit, range: #3}) #4
}
\newcommand\bImage
{
	\begin{figure}[H]
		\begin{center}
			\includegraphics[width = 0.48\textwidth,height = \imageHeight\textwidth, keepaspectratio]{../Images/\image}
		\end{center}
	\end{figure}

}

\newcommand \lineCross[1]
{
	\if #11
	{
		\dndlineLong
	}
	\fi
	\if #12
	{
		\dndline
	}
	\fi
}



\newcommand\beastBox[1]
{
	\definecolor{backcol}{HTML}{58180D}
	\definecolor{linecol}{HTML}{9C2B1B}

	\begin{tcolorbox}[  before skip=7pt plus 2pt,
						boxrule=0pt,
						boxsep=0pt,
						toptitle=4pt,
						left=7pt,
	  					right=7pt,
	  					bottom=11pt,
	  					arc=0.5mm,
	  					oversize=0pt,
	  					colback=papyrus,
	 					colbacktitle=backcol,
						colframe=backcol, title=\vspace{-4ex}
						]
		
		\if#12
		\begin{multicols}{2}
		\fi
		
		\titleBlock
		%\vspace{-3.3ex}
		\lineCross{#1}

		
		
		\begin{tabular}{@{} r l r l @{}}
			
			\if\fpMode1
				\bf Health: 	&	 \hp{}~Points	&	 \bf Fortitude:	&	\fp{}~Points \\
			\fi
			\if \fpMode0
				\bf Health: 	&	\hp{}	Points &	~&  ~  \\
			\fi
			\bf Block:	&	\block & 	\bf Dodge:	&	\dodge \\	
			\bf Speed : 	&	\parbox[t]{2.5 cm}{\raggedright \small \it \speed}	&	\bf \sizeName	&	\size
		\end{tabular}

		 \statTable{#1}
		
		
		\if\aBlock1
			\abilitiesBlock{#1}
		\fi
		
		\if\actionMode1
			 \subsection*{\color{titlered}{Actions}}
			 {
			\setlength\parskip{3 pt}
			 \actions
			 }
		\fi
		
		\if\hasLair1

			\subsection*{\color{titlered}{Lair Abilities}}
			 {
			\setlength\parskip{3 pt}
			 \lairActions
			 }
		\fi 
		
		\vspace{1.4 ex}
		
		\if#12
		\end{multicols}
		\fi
		
	\end{tcolorbox}
	
}

\newcommand{\beast}[2]
{
	\begingroup
	
	\defaultSetter
	
	\setkeys{beast}{#1}
	
	\small 
	\if#20
		\if\needsPage1
			\newpage
		\fi
	\fi
	\if#21
		\clearpage
	\fi
	
	
	\if\imageMode1
		\if\imagePos0
			\bImage{}
		\fi
	\fi
	
	\if#20
		\subsection*{\bf \name}
		\addcontentsline{toc}{subsection}{\name}
		
		\if\hasHabitat1
		
		{\bf Habitat: } \habitat
		\fi
		
		\description
		
	\fi
	
	\if#21
	
		\section*{\bf \name}
		\addcontentsline{toc}{section}{\name}
	
		\description
		
		{\bf Habitat: } \habitat
		
		
	\fi	
	
	

	
	\beastBox{1}

	
	\if\imageMode1
		\if\imagePos1
		\vfill
			\bImage{}
		\vfill
		\fi
	\fi	
	
	\endgroup
}

\newcommand\boxOnlyBeast[1]
{
	\begingroup
	\defaultSetter
	\setkeys{beast}{#1}
	
	\small 
	
	\beastBox{1}
	
	\endgroup
}


\newcommand{\fullPageBeast}[2]
{
	\begingroup
	\defaultSetter
	\setkeys{beast}{#1}
	
	\small 
	
	\clearpage
	\if#20
		\subsection*{\bf \name}
		\addcontentsline{toc}{subsection}{\name}
		\if\hasHabitat1
		
		{\bf Habitat: } \habitat
		\fi
		
		\description
		
	\fi
	
	\if#21
	
		\section*{\bf \name}
		\addcontentsline{toc}{section}{\name}
	
		\description
		
		{\bf Habitat: } \habitat
		
		
	\fi	
	
	\if\imageMode1
		\bImage{}
	\fi
	

	\begin{strip}
	\beastBox{2}	
	\end{strip}

	\endgroup
	~
	
}

\newcommand\species[6]
{
	\clearpage
	\section*{\Huge #1}
	\addcontentsline{toc}{section}{#1}
	#2

	\if#41
		\def\image{#5}
		\def\imageHeight{#6}

		\vfill
			\bImage{}
		\vfill
	\fi

	
	#3
	
	
}


